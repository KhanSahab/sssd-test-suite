# Windows DNS client needs to be set multiple times,
# 1) to ensure that forest  domain is reachable when installing child domain,
# 2) to ensure that other domains are reachable.
# AD server will use otherwise itself as DNS server and we would have to
# create glue records.

---
- hosts: ipa:ldap:client
  roles:
  - packages
  - common
  vars_files:
  - variables.yml

- hosts: ad:ad-child
  roles:
  - win-common
  - win-dnsclient
  vars_files:
  - variables.yml

- hosts: ad
  roles:
  - win-forest
  - win-dnsclient
  vars_files:
  - variables.yml

- hosts: ipa
  roles:
  - ipa
  vars_files:
  - variables.yml
  
- hosts: ad-child
  roles:
  - win-domain
  - win-dnsclient
  vars_files:
  - variables.yml

- hosts: ipa:ldap:client
  roles:
  - dnsclient
  vars_files:
  - variables.yml

- hosts: ldap
  roles:
  - ldap
  vars_files:
  - variables.yml
  
- hosts: client
  roles:
  - sssd
  vars_files:
  - variables.yml
